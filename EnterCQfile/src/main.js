//import Vue from 'vue';
//import cq from '../data/Chongqing'; 
//import hotspot from '../data/Select'; 
/* var app = new Vue({
  el: '#app',
  data: {
    message: '企业集聚可视化 | 重庆'
  }
}); */


//添加底图
//L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
//attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',}).addTo(map);
var osmUrl = 'https://api.mapbox.com/styles/v1/billcui/cjlkbj9h32w5i2spkiyygo6wb/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYmlsbGN1aSIsImEiOiJjampsYjZpbzQwcm1mM3FwZmppejRzMmNiIn0.Ch9L9-zpzaC21Vm8yxoWpg',
    osm = L.tileLayer(osmUrl, {
        maxZoom: 18,
        minZoom: 5,
        opacity: 1
    });
var map = new L.Map('map').addLayer(osm).setView([30.25, 109.15], 8);


var mystyle1 = { "color": "#ffffff", "weight": 3, opacity: 0.8 };

var chongqing = require('../data/cq.json');
L.geoJSON(chongqing, { style: mystyle1 }).addTo(map);
var thelayer;

addjson('95', '1', '1');

function addjson(timenum, indusnum, scalenum) {
    var timestring;
    if (timenum==='95'){
        timestring='1996-2000';
    }else if(timenum==='105'){
        timestring='2001-2005';
    }else if(timenum==='115'){
        timestring='2006-2010';
    }else if(timenum==='125'){
        timestring='2011-2015';
    }
    

    var jsonpath = timenum + '_' + indusnum + '_' + scalenum + '_84'
    var spots = require('../data/' + jsonpath + '.json');
    thelayer = L.geoJSON(spots, {
        style: function (features) {
            switch (features.properties.Gi_Bin) {
                case 1: return { color: "#ff9f00", weight: 0.5, opacity: 0.3, fillOpacity: 0.3 };
                case 2: return { color: "#ff4000", weight: 0.5, opacity: 0.7, fillOpacity: 0.6 };
                case 3: return { color: "#ff0000", weight: 0.5, opacity: 1, fillOpacity: 0.9 };
            }

        }
    }).addTo(map);

   // document.getElementById('timeperiod').innerText=timestring;
}

function draw3Dbar(indusnum, data) {

    //var app = {};
    option = null;

    var days = ['1996-2000', '2001-2005', '2006-2010', '2011-2015'];
    var hours = ['1km', '2km', '3km', '4km', '5km', '6km', '7km', '8km', '9km'
        , '10km', '11km', '12km', '13km', '14km', '15km', '16km', '17km', '18km', '19km', '20km'];
    var tdata = data.join(',').split(',');
    var maxdata = Math.max.apply(null, tdata);
    option = {
        title: {
            text: 'the General G Z-score of ' + indusnum,
            x: 'center',
            align: 'right',
            textStyle: {
                color: '#fff',
                fontSize: 18,
            },
            top: 15
        },
        tooltip: {},
        visualMap: {
            max: maxdata,
            min: 10,
            inRange: {
                color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']
            }
        },
        xAxis3D: {
            type: 'category',
            data: hours,
            axisLabel: {
                show: true,
                textStyle: {
                    color: '#fff'
                }
            }
        },
        yAxis3D: {
            type: 'category',
            data: days,
            axisLabel: {
                show: true,
                textStyle: {
                    color: '#fff'
                }
            }
        },
        zAxis3D: {
            type: 'value',
            axisLabel: {
                show: true,
                textStyle: {
                    color: '#fff'
                }
            }
        },
        grid3D: {
            boxWidth: 120,
            boxDepth: 50,
            light: {
                main: {
                    intensity: 1.2
                },
                ambient: {
                    intensity: 0.3
                }
            }
        },
        series: [{
            type: 'bar3D',
            data: data.map(function (item) {
                return {
                    value: [item[1], item[0], item[2]]
                }
            }),
            shading: 'color',

            label: {
                show: false,
                textStyle: {
                    fontSize: 1,
                    borderWidth: 1
                }
            },

            itemStyle: {
                opacity: 0.7
            },

            emphasis: {
                label: {
                    textStyle: {
                        fontSize: 20,
                        color: '#ffffff'
                    }
                },
                itemStyle: {
                    color: '#ffffff'
                }
            }
        }]
    };
    if (option && typeof option === "object") {
        myChart.setOption(option, true);

    }

}

var dom = document.getElementById("menu2");
var myChart = echarts.init(dom);

var data = [[0, 0, 23.781161000000001], [0, 1, 12.988618000000001], [0, 2, 14.317508], [0, 3, 13.03745], [0, 4, 15.666128], [0, 5, 16.558479999999999], [0, 6, 18.957339000000001], [0, 7, 18.577969], [0, 8, 20.214192000000001], [0, 9, 16.487366999999999], [0, 10, 15.380319999999999], [0, 11, 16.064523999999999], [0, 12, 13.154604000000001], [0, 13, 14.4209], [0, 14, 10.843667], [0, 15, 12.726741000000001], [0, 16, 11.855460000000001], [0, 17, 10.758191999999999], [0, 18, 10.894793], [0, 19, 9.7552389999999995], [1, 0, 18.017219000000001], [1, 1, 30.066481], [1, 2, 33.647039999999997], [1, 3, 27.728653999999999], [1, 4, 35.509864999999998], [1, 5, 26.638833000000002], [1, 6, 31.055137999999999], [1, 7, 25.670026], [1, 8, 20.521927999999999], [1, 9, 18.370936], [1, 10, 20.370398000000002], [1, 11, 17.316559000000002], [1, 12, 16.160072], [1, 13, 16.023199999999999], [1, 14, 14.695812], [1, 15, 13.188221], [1, 16, 13.900566], [1, 17, 10.336790000000001], [1, 18, 11.778838], [1, 19, 10.154792], [2, 0, 35.060600999999998], [2, 1, 27.988434999999999], [2, 2, 27.759343999999999], [2, 3, 24.129982999999999], [2, 4, 24.068911], [2, 5, 23.481919000000001], [2, 6, 21.23743], [2, 7, 20.492846], [2, 8, 18.063316], [2, 9, 16.15898], [2, 10, 16.510279000000001], [2, 11, 16.168396999999999], [2, 12, 15.924849999999999], [2, 13, 14.677362], [2, 14, 12.156610000000001], [2, 15, 13.264989], [2, 16, 13.326124], [2, 17, 9.6869429999999994], [2, 18, 12.533321000000001], [2, 19, 9.4667770000000004], [3, 0, 30.556287000000001], [3, 1, 20.241012000000001], [3, 2, 18.783373999999998], [3, 3, 15.129212000000001], [3, 4, 20.530076999999999], [3, 5, 18.181602000000002], [3, 6, 16.196358], [3, 7, 16.744357000000001], [3, 8, 16.724906000000001], [3, 9, 15.531497], [3, 10, 14.253906000000001], [3, 11, 14.721164999999999], [3, 12, 14.195430999999999], [3, 13, 13.305255000000001], [3, 14, 11.283533], [3, 15, 11.910361999999999], [3, 16, 12.560608], [3, 17, 9.0485410000000002], [3, 18, 11.391367000000001], [3, 19, 8.3773389999999992]];
var indusname = 'primary industry';
draw3Dbar(indusname, data);



function autochange(indusnum, scalenum) {
    var indusseries = ['95', '105', '115', '125'];
    for (let i = 0; i < indusseries.length; i++) {
        setTimeout(function timr() {
            map.removeLayer(thelayer);
            console.log(i);
            addjson(indusseries[i], indusnum, scalenum);
        }, i * 2000);
    }
}

autochange('1','1');


window.timechange = function () {

    var timenum = $("#time").val();
    var indusnum = $("#indus").val();
    var scalenum = $("#scale").val();
    if (timenum === 'auto') {
        autochange(indusnum, scalenum);
    }
    else {
        map.removeLayer(thelayer);
        addjson(timenum, indusnum, scalenum);
    }


}

window.induschange = function () {
    var timenum = $("#time").val();
    var indusnum = $("#indus").val();
    var scalenum = $("#scale").val();

    if (indusnum === '1') {
        var data = [[0, 0, 23.781161000000001], [0, 1, 12.988618000000001], [0, 2, 14.317508], [0, 3, 13.03745], [0, 4, 15.666128], [0, 5, 16.558479999999999], [0, 6, 18.957339000000001], [0, 7, 18.577969], [0, 8, 20.214192000000001], [0, 9, 16.487366999999999], [0, 10, 15.380319999999999], [0, 11, 16.064523999999999], [0, 12, 13.154604000000001], [0, 13, 14.4209], [0, 14, 10.843667], [0, 15, 12.726741000000001], [0, 16, 11.855460000000001], [0, 17, 10.758191999999999], [0, 18, 10.894793], [0, 19, 9.7552389999999995], [1, 0, 18.017219000000001], [1, 1, 30.066481], [1, 2, 33.647039999999997], [1, 3, 27.728653999999999], [1, 4, 35.509864999999998], [1, 5, 26.638833000000002], [1, 6, 31.055137999999999], [1, 7, 25.670026], [1, 8, 20.521927999999999], [1, 9, 18.370936], [1, 10, 20.370398000000002], [1, 11, 17.316559000000002], [1, 12, 16.160072], [1, 13, 16.023199999999999], [1, 14, 14.695812], [1, 15, 13.188221], [1, 16, 13.900566], [1, 17, 10.336790000000001], [1, 18, 11.778838], [1, 19, 10.154792], [2, 0, 35.060600999999998], [2, 1, 27.988434999999999], [2, 2, 27.759343999999999], [2, 3, 24.129982999999999], [2, 4, 24.068911], [2, 5, 23.481919000000001], [2, 6, 21.23743], [2, 7, 20.492846], [2, 8, 18.063316], [2, 9, 16.15898], [2, 10, 16.510279000000001], [2, 11, 16.168396999999999], [2, 12, 15.924849999999999], [2, 13, 14.677362], [2, 14, 12.156610000000001], [2, 15, 13.264989], [2, 16, 13.326124], [2, 17, 9.6869429999999994], [2, 18, 12.533321000000001], [2, 19, 9.4667770000000004], [3, 0, 30.556287000000001], [3, 1, 20.241012000000001], [3, 2, 18.783373999999998], [3, 3, 15.129212000000001], [3, 4, 20.530076999999999], [3, 5, 18.181602000000002], [3, 6, 16.196358], [3, 7, 16.744357000000001], [3, 8, 16.724906000000001], [3, 9, 15.531497], [3, 10, 14.253906000000001], [3, 11, 14.721164999999999], [3, 12, 14.195430999999999], [3, 13, 13.305255000000001], [3, 14, 11.283533], [3, 15, 11.910361999999999], [3, 16, 12.560608], [3, 17, 9.0485410000000002], [3, 18, 11.391367000000001], [3, 19, 8.3773389999999992]];
        var indusname = 'primary industry';
    } else if (indusnum === '2') {
        var data = [[0, 0, 114.420053], [0, 1, 89.030411000000001], [0, 2, 71.601591999999997], [0, 3, 64.762460000000004], [0, 4, 55.682164], [0, 5, 47.250549999999997], [0, 6, 40.418353000000003], [0, 7, 35.985672000000001], [0, 8, 31.780194000000002], [0, 9, 27.656929999999999], [0, 10, 25.047650000000001], [0, 11, 22.718715], [0, 12, 22.420159999999999], [0, 13, 18.817737000000001], [0, 14, 18.425464999999999], [0, 15, 15.602881], [0, 16, 17.079564000000001], [0, 17, 13.810738000000001], [0, 18, 14.760756000000001], [0, 19, 12.445524000000001], [1, 0, 111.134109], [1, 1, 86.447913999999997], [1, 2, 68.406076999999996], [1, 3, 60.507323999999997], [1, 4, 56.341957999999998], [1, 5, 46.745381000000002], [1, 6, 40.894893000000003], [1, 7, 34.451115999999999], [1, 8, 30.757919000000001], [1, 9, 28.390232000000001], [1, 10, 24.954315000000001], [1, 11, 21.737646999999999], [1, 12, 21.672552], [1, 13, 17.819468000000001], [1, 14, 18.380974999999999], [1, 15, 15.142607], [1, 16, 16.918417999999999], [1, 17, 13.612818000000001], [1, 18, 14.739549999999999], [1, 19, 12.522589], [2, 0, 96.938968000000003], [2, 1, 82.730255999999997], [2, 2, 65.516839000000004], [2, 3, 54.807768000000003], [2, 4, 50.143465999999997], [2, 5, 43.606172000000001], [2, 6, 37.619765999999998], [2, 7, 32.159180999999997], [2, 8, 28.795544], [2, 9, 26.995083999999999], [2, 10, 23.512703999999999], [2, 11, 19.872698], [2, 12, 18.993507999999999], [2, 13, 17.375689999999999], [2, 14, 17.010543999999999], [2, 15, 14.845404], [2, 16, 16.527474000000002], [2, 17, 12.554917], [2, 18, 13.833133999999999], [2, 19, 11.921643], [3, 0, 70.621401000000006], [3, 1, 59.536254999999997], [3, 2, 45.531861999999997], [3, 3, 36.373021999999999], [3, 4, 37.701743999999998], [3, 5, 32.300322999999999], [3, 6, 26.087551999999999], [3, 7, 23.540899], [3, 8, 22.032052], [3, 9, 22.859745], [3, 10, 18.224549], [3, 11, 18.044944000000001], [3, 12, 18.278509], [3, 13, 14.300053], [3, 14, 14.867656], [3, 15, 13.684476], [3, 16, 15.747669], [3, 17, 11.120960999999999], [3, 18, 12.64452], [3, 19, 11.527659]];
        var indusname = 'secondary industry';
    } else if (indusnum === '31') {
        var data = [[0, 0, 32.191049999999997], [0, 1, 37.705305000000003], [0, 2, 23.781694999999999], [0, 3, 29.974976999999999], [0, 4, 29.853249000000002], [0, 5, 29.62921], [0, 6, 25.071871999999999], [0, 7, 22.699649000000001], [0, 8, 21.158102], [0, 9, 16.756912], [0, 10, 16.623349999999999], [0, 11, 17.536446000000002], [0, 12, 16.255223000000001], [0, 13, 14.401261999999999], [0, 14, 12.82207], [0, 15, 11.999461], [0, 16, 13.870576], [0, 17, 9.7404969999999995], [0, 18, 11.506717], [0, 19, 9.4228749999999994], [1, 0, 97.181864000000004], [1, 1, 69.555179999999993], [1, 2, 55.310667000000002], [1, 3, 52.024245999999998], [1, 4, 41.593775999999998], [1, 5, 39.371397999999999], [1, 6, 32.162199999999999], [1, 7, 27.496641], [1, 8, 25.02796], [1, 9, 17.364034], [1, 10, 18.718551999999999], [1, 11, 17.646735], [1, 12, 15.075564999999999], [1, 13, 15.119771], [1, 14, 12.351858], [1, 15, 9.8273299999999999], [1, 16, 13.793049], [1, 17, 8.8708670000000005], [1, 18, 10.791897000000001], [1, 19, 8.953087], [2, 0, 120.113254], [2, 1, 73.893365000000003], [2, 2, 59.421551000000001], [2, 3, 49.191958], [2, 4, 41.803030999999997], [2, 5, 35.736857000000001], [2, 6, 31.422246000000001], [2, 7, 26.203357], [2, 8, 24.090599000000001], [2, 9, 16.859411999999999], [2, 10, 18.248508000000001], [2, 11, 15.869144], [2, 12, 13.496309], [2, 13, 14.136393999999999], [2, 14, 11.003826], [2, 15, 8.7597970000000007], [2, 16, 12.731999], [2, 17, 8.0662179999999992], [2, 18, 9.2860569999999996], [2, 19, 8.3751329999999999], [3, 0, 164.98520099999999], [3, 1, 85.662462000000005], [3, 2, 60.902881999999998], [3, 3, 47.128086000000003], [3, 4, 41.503582000000002], [3, 5, 33.068793999999997], [3, 6, 31.321736999999999], [3, 7, 25.789432000000001], [3, 8, 23.688987000000001], [3, 9, 17.257867000000001], [3, 10, 17.738606999999998], [3, 11, 15.377824], [3, 12, 12.952482], [3, 13, 14.082613], [3, 14, 11.697206], [3, 15, 9.5329090000000001], [3, 16, 12.556703000000001], [3, 17, 8.3244209999999992], [3, 18, 9.3074680000000001], [3, 19, 8.8165530000000008]];
        var indusname = 'tertiary industry(1)';
    } else if (indusnum === '32') {
        var data = [[0, 0, 168.58160899999999], [0, 1, 96.172400999999994], [0, 2, 75.193539999999999], [0, 3, 55.825519999999997], [0, 4, 46.527850000000001], [0, 5, 40.108887000000003], [0, 6, 36.096825000000003], [0, 7, 30.771692999999999], [0, 8, 27.093585000000001], [0, 9, 19.660578999999998], [0, 10, 19.16826], [0, 11, 18.240904], [0, 12, 16.002212], [0, 13, 16.887615], [0, 14, 13.490741], [0, 15, 12.17943], [0, 16, 14.337676999999999], [0, 17, 10.281635], [0, 18, 11.372983], [0, 19, 9.9623179999999998], [1, 0, 175.53370799999999], [1, 1, 93.878395999999995], [1, 2, 76.714794999999995], [1, 3, 56.592143999999998], [1, 4, 48.996687999999999], [1, 5, 38.769945999999997], [1, 6, 36.653419], [1, 7, 29.636993], [1, 8, 26.865566999999999], [1, 9, 19.434787], [1, 10, 19.386263], [1, 11, 17.695018999999998], [1, 12, 15.147515], [1, 13, 16.138577000000002], [1, 14, 13.264125], [1, 15, 10.574315], [1, 16, 13.954807000000001], [1, 17, 9.4729480000000006], [1, 18, 10.604699999999999], [1, 19, 9.6542510000000004], [2, 0, 187.83600000000001], [2, 1, 100.542755], [2, 2, 73.555753999999993], [2, 3, 56.585503000000003], [2, 4, 52.136704999999999], [2, 5, 38.591400999999998], [2, 6, 37.090555000000002], [2, 7, 30.313981999999999], [2, 8, 26.713801], [2, 9, 19.775137999999998], [2, 10, 19.726268000000001], [2, 11, 16.963066000000001], [2, 12, 14.475865000000001], [2, 13, 15.442329000000001], [2, 14, 12.202138], [2, 15, 10.450474], [2, 16, 13.128738], [2, 17, 8.8021639999999994], [2, 18, 9.4686669999999999], [2, 19, 9.2019579999999994], [3, 0, 207.03820999999999], [3, 1, 113.526078], [3, 2, 78.924085000000005], [3, 3, 64.040526999999997], [3, 4, 55.450674999999997], [3, 5, 39.840921999999999], [3, 6, 39.376224000000001], [3, 7, 32.134580999999997], [3, 8, 27.935941], [3, 9, 22.171977999999999], [3, 10, 21.062474000000002], [3, 11, 17.508514999999999], [3, 12, 14.738035999999999], [3, 13, 16.367892999999999], [3, 14, 13.721995], [3, 15, 12.189672], [3, 16, 13.464943999999999], [3, 17, 9.9134049999999991], [3, 18, 9.9736550000000008], [3, 19, 9.9573269999999994]];
        var indusname = 'tertiary industry(2)';
    } else if (indusnum === '33') {
        var data = [[0, 0, 211.13795400000001], [0, 1, 84.856534999999994], [0, 2, 80.080264], [0, 3, 57.235829000000003], [0, 4, 45.540869000000001], [0, 5, 37.866464000000001], [0, 6, 37.211190000000002], [0, 7, 29.913188999999999], [0, 8, 27.756964], [0, 9, 19.777569], [0, 10, 18.934840999999999], [0, 11, 18.102888], [0, 12, 17.572399999999998], [0, 13, 15.803976], [0, 14, 12.647264], [0, 15, 12.829563], [0, 16, 14.802177], [0, 17, 9.9883089999999992], [0, 18, 11.375152999999999], [0, 19, 9.2767060000000008], [1, 0, 185.087467], [1, 1, 82.069847999999993], [1, 2, 78.748054999999994], [1, 3, 54.746661000000003], [1, 4, 50.172339999999998], [1, 5, 40.355111999999998], [1, 6, 35.781078000000001], [1, 7, 29.322627000000001], [1, 8, 27.332827000000002], [1, 9, 19.969888999999998], [1, 10, 20.407332], [1, 11, 18.565764000000001], [1, 12, 16.011675], [1, 13, 15.379106], [1, 14, 13.127599999999999], [1, 15, 11.066813], [1, 16, 14.122448], [1, 17, 9.4417840000000002], [1, 18, 11.036439], [1, 19, 9.5630400000000009], [2, 0, 159.60180099999999], [2, 1, 90.072822000000002], [2, 2, 71.813744], [2, 3, 56.202195000000003], [2, 4, 50.789974999999998], [2, 5, 40.458917999999997], [2, 6, 37.374952], [2, 7, 30.75029], [2, 8, 27.122582999999999], [2, 9, 20.593381000000001], [2, 10, 19.654658999999999], [2, 11, 17.11891], [2, 12, 15.129759], [2, 13, 15.721042000000001], [2, 14, 12.876175999999999], [2, 15, 10.502045000000001], [2, 16, 12.92291], [2, 17, 9.0102519999999995], [2, 18, 9.9602579999999996], [2, 19, 9.5353169999999992], [3, 0, 192.80527900000001], [3, 1, 111.929529], [3, 2, 84.053432000000001], [3, 3, 69.241685000000004], [3, 4, 58.081854999999997], [3, 5, 43.781216999999998], [3, 6, 41.416877999999997], [3, 7, 33.996613000000004], [3, 8, 29.880787000000002], [3, 9, 23.738671], [3, 10, 22.710529999999999], [3, 11, 19.285449], [3, 12, 16.514835000000001], [3, 13, 17.632774999999999], [3, 14, 14.851312], [3, 15, 13.572800000000001], [3, 16, 14.342551], [3, 17, 10.716556000000001], [3, 18, 10.900881999999999], [3, 19, 10.661614]];
        var indusname = 'tertiary industry(3)';
    }
    myChart.clear();
    draw3Dbar(indusname, data);
    if (timenum === 'auto') {
        autochange(indusnum, scalenum);
    }
    else {
        map.removeLayer(thelayer);
        addjson(timenum, indusnum, scalenum);
    }
}

window.scalechange = function () {

    var timenum = $("#time").val();
    var indusnum = $("#indus").val();
    var scalenum = $("#scale").val();
    if (timenum === 'auto') {
        autochange(indusnum, scalenum);
    }
    else {
        map.removeLayer(thelayer);
        addjson(timenum, indusnum, scalenum);
    }
}
